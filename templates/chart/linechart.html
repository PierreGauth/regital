
{% comment %}

			Template pour les bar chart
			
			Utilisation :
				Il suffit de passer une variable data contenant une liste de dict champs : valeurs
				Le premier éléments de cette liste est un élément particulier qui permet de savoir quel
				champs est a afficher en abscisse, en ordonnée ou en option (représenté par la couleur des barres)
				Ce premier élément est un dictionnaire qui doit contenir la clef x, la clef y et la clef opt 
			
			Exemple :
				[
					{'x' : 'temps', 'y' : 'population', 'opt' : ['nationalité', 'age']},
					{'temps' : '1', 'population : '123', 'nationalité' : 'test', 'age' : 'truc' },
					{'temps' : '2', 'population : '153	, 'nationalité' : 'test', 'age' : 'truc' },
					{'temps' : '3', 'population : '453', 'nationalité' : 'test', 'age' : 'truc' },
					{'temps' : '4', 'population : '123', 'nationalité' : 'test', 'age' : 'truc' },
					{'temps' : '5', 'population : '163', 'nationalité' : 'test', 'age' : 'truc' },
					{'temps' : '6', 'population : '123', 'nationalité' : 'test', 'age' : 'truc' },
					{'temps' : '7', 'population : '83',  'nationalité' : 'test', 'age' : 'truc' },
					{'temps' : '8', 'population : '3',   'nationalité' : 'test', 'age' : 'truc' },
					{'temps' : '9', 'population : '13',  'nationalité' : 'test', 'age' : 'truc' }
				]
				Ces donnée permetterons d'afficher un bar chart de la population selon le temps avec la possibilité de 
				colorer les barres selon la nationalité ou l'age
				
				/!\ le champ y doit être des valeurs numérique
{% endcomment %}

<style>
.lineChartArea{{chartId}} {
  font: 10px sans-serif;
}

.lineChartAxis path,
.lineChartAxis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.x.lineChartAxis path {
  display: none;
}

.line {
  fill: none;
  stroke: steelblue;
  stroke-width: 1.5px;
}
</style>

<div id="lineChartRadioArea{{chartId}}">
	<input type="radio" name="lineChartOpt{{chartId}}" value="---" checked="checked">Rien</input></br>
</div>
<div class="lineChartArea{{chartId}}"></div>

<script src="/static/js/d3.min.js"></script>
<script>

var {{chartId}}data = {{data|safe}};
var {{chartId}}info = {{chartId}}data[0];
{{chartId}}data.splice(0,1);

var {{chartId}}margin = {top: 40, right: 20, bottom: 30, left: 40},
    {{chartId}}width = 960 - {{chartId}}margin.left - {{chartId}}margin.right,
    {{chartId}}height = 300 - {{chartId}}margin.top - {{chartId}}margin.bottom;

var {{chartId}}parseDate = d3.time.format("%Y-%m-%d").parse;
for (i = 0; i < {{chartId}}data.length; ++i) {
    {{chartId}}data[i]['date'] = {{chartId}}parseDate({{chartId}}data[i]['date']);
}

var {{chartId}}x = d3.time.scale()
		.range([0, {{chartId}}width]);

var {{chartId}}y = d3.scale.linear()
    .range([{{chartId}}height, 0]);

var {{chartId}}xAxis = d3.svg.axis()
    .scale({{chartId}}x)
    .orient("bottom");

var {{chartId}}yAxis = d3.svg.axis()
    .scale({{chartId}}y)
    .orient("left");	

var {{chartId}}line = d3.svg.line()
    .x(function(d) { return {{chartId}}x(d[{{chartId}}info.x]); })
    .y(function(d) { return {{chartId}}y(d[{{chartId}}info.y]); });

var {{chartId}}svg = d3.select(".lineChartArea{{chartId}}").append("svg")
    .attr("width", {{chartId}}width + {{chartId}}margin.left + {{chartId}}margin.right)
    .attr("height", {{chartId}}height + {{chartId}}margin.top + {{chartId}}margin.bottom)
  .append("g")
    .attr("transform", "translate(" + {{chartId}}margin.left + "," + {{chartId}}margin.top + ")");
		
{{chartId}}x.domain(d3.extent({{chartId}}data, function(d) { return d[{{chartId}}info.x]; }));
{{chartId}}y.domain(d3.extent({{chartId}}data, function(d) { return d[{{chartId}}info.y]; }));

{{chartId}}svg.append("g")
    .attr("class", "x lineChartAxis")
    .attr("transform", "translate(0," + {{chartId}}height + ")")
    .call({{chartId}}xAxis);

{{chartId}}svg.append("g")
    .attr("class", "y lineChartAxis")
    .call({{chartId}}yAxis)
  .append("text")
    .attr("transform", "rotate(-90)")
    .attr("y", 6)
    .attr("dy", ".71em")
    .style("text-anchor", "end")
    .text("Price ($)");

{{chartId}}svg.append("path")
    .datum({{chartId}}data)
    .attr("class", "line")
    .attr("d", {{chartId}}line);
		
</script>
